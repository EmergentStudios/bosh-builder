<?xml version="1.0" encoding="UTF-8"?>
<svg viewBox="0 0 70 70" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" xmlns:lr="https://www.linerider.com">
  <style type="text/css"><![CDATA[
    .lr-anchor {
      display: none;
      stroke-width: 0.2px;
      stroke: red;
      fill: cyan;
    }
    .lr-bbox {
      display: none;
      stroke-width: 0.2px;
      stroke: blue;
      fill: none;
    }
    .no-fill {
      fill: none;
    }
    .flag {
      fill: rgba(0,0,0,0.4);
    }
    .outline {
      stroke: black;
      stroke-width: 0.3;
    }
    .face .skin {
      fill: white;
    }
    .face .hair {
      fill: black;
    }
    .eye {
      fill: black;
    }
    .torso {
      fill: white;
    }
    .neck .odd {
      fill: white;
    }
    .scarf0 {
      fill: white;
    }
    .scarf1 {
      fill: #3995FD;
    }
    .scarf3 {
      fill: #06A725;
    }
    .scarf5 {
      fill: #FD4F38;
    }
    .hat .ball {
      fill: black;
    }
    .hat .top {
      fill: white;
    }
    .hat .bottom {
      stroke: black;
      stroke-width: 1;
      stroke-linecap: round;
    }
    .sled {
      fill: white;
    }
    .arm .sleeve {
      fill: black;
    }
    .arm .hand {
      fill: white;
    }
    .leg .pants {
      fill: black;
    }
    .leg .foot {
      fill: white;
    }
  ]]></style>
  <defs>
    <!-- components -->
    <path id="eye" class="eye" d="M8.9,1.1L8.5,1L8.1,1.1L8,1.5l0.1,0.4C8.3,2,8.3,2,8.5,2s0.2,0,0.4-0.1L9,1.5L8.9,1.1z" />
    <rect id="closed-eye" class="eye" x="8.2" y="0.9" width="0.4" height="1.2"/>
    <g id="face-sides" class="face">
      <rect class="skin" x="7" y="-0.3" width="3.1" height="9.9" />
      <rect id="hair" class="hair" x="7" y="-5.1" width="3.1" height="4.9" />
      <use class="hair" xlink:href="#hair" x="0" y="10.8"/>
    </g>
    <g id="face" class="face">
      <use xlink:href="#face-sides"/>
      <use class="right" xlink:href="#eye"/>
      <use class="left" xlink:href="#eye" x="0" y="2.4"/>
    </g>
    <g id="face-blinking" class="face">
      <use xlink:href="#face-sides"/>
      <use class="right" xlink:href="#closed-eye"/>
      <use class="left" xlink:href="#closed-eye" x="0" y="2.4"/>
    </g>

    <!-- parts -->
    <g id="sled" class="sled outline">
      <path class="whole" d="M16.2-1.2c-0.7-0.7-1.6-1.1-2.6-1.1c-1,0-1.9,0.4-2.6,1.1l-0.6,0.8H0l-0.2,0.2L-0.3,0l0.2,0.2c0,0.1,0.1,0.1,0.2,0.1h1.7v4h-1.9c-0.1,0-0.2,0.1-0.2,0.1l-0.1,0.3L-0.5,5c0.1,0.1,0.2,0.1,0.2,0.1h13.9c1,0,1.9-0.4,2.6-1c0.8-0.8,1.1-1.6,1.1-2.6C17.3,0.4,16.9-0.4,16.2-1.2z M9,4.4H2.5v-4H9V4.4zM15.7,3.5c-0.6,0.6-1.2,0.9-2.1,0.9H9.8v-4H10L9.9,0.7L10,1l0.2,0.1l0.2,0l0.1-0.2l0.1-0.5h0.9l0.3-0.1L12.2,0l-0.1-0.2l-0.2-0.1h-0.5l0.2-0.2c0.6-0.6,1.3-0.9,2.1-0.9c0.9,0,1.6,0.3,2.1,0.9c0.6,0.6,0.8,1.2,0.8,2.1C16.5,2.2,16.2,3,15.7,3.5z"/>
    </g>
    <g id="broken-sled" class="sled broke outline">
      <path class="top" d="M10.9-1.2l-0.6,0.8H0l-0.3,0.2L-0.4,0l0.1,0.3C-0.2,0.3-0.1,0.4,0,0.4h1.7v0.8l0.7-0.5V0.3H9v0.4l0.8,0.5V0.3H10L9.9,0.7L10,1l0.2,0.1l0.2,0l0.1-0.2l0.1-0.6h0.9l0.2-0.1L12.1,0L12-0.3l-0.2-0.1h-0.5l0.2-0.2c0.6-0.6,1.2-0.9,2.1-0.9s1.5,0.3,2.1,0.9l0.2,0.2L16.9,0c-0.2,0.4-0.5-0.9-0.8-1.1c-0.7-0.8-1.6-1.2-2.6-1.2S11.7-1.9,10.9-1.2z"/>
      <path class="tail" d="M1.4-0.8L0.9-0.1l1.5,2.9L0.4,3.3L0.2,3.5c0,0.1,0,0.2,0,0.2L0.5,4h0.2l6.6-1.8L6.1,1.8L3,2.7L1.4-0.8z"/>
      <path class="middle" d="M5.9,1.8L9,1l0.4-0.9L6.1,1L5.9,1.8z"/>
      <path class="nose" d="M16.7-0.1l-1-0.7c0.2,0.6,0.3,1.2,0.1,2c-0.2,0.8-0.7,1.4-1.4,1.7S13,3.4,12.2,3.2l-3.7-1V2.1L7.9,1.6L7.8,1.9L4.7,1l0.6,1L12,3.9C13,4.2,13.9,4,14.8,3.6c0.9-0.5,1.5-1.2,1.7-2.2C16.7,0.9,16.7,0.4,16.7-0.1z"/>
    </g>
    <g id="leg" class="leg outline">
      <path class="pants" d="M4.8-0.7H0.4L0-0.8l-0.5,0.2l-0.1,0.2L-0.7,0l0.1,0.4l0.1,0.1L0,0.7l0.3-0.1h4.6"/>
      <path class="foot" d="M4.8,0.6h2.4v-2.6L6.7-2L6-0.7H4.8"/>
    </g>
    <g id="body">
      <rect class="torso outline" x="0" y="-2.2" width="7" height="4.4"/>
      <g class="neck">
        <rect class="scarf1 even" stroke-width="0" x="5.2" y="1.5" width="2" height="1"/>
        <rect class="scarf2 odd"  stroke-width="0" x="5.2" y="0.5" width="2" height="1"/>
        <rect class="scarf3 even" stroke-width="0" x="5.2" y="-0.5" width="2" height="1"/>
        <rect class="scarf4 odd"  stroke-width="0" x="5.2" y="-1.5" width="2" height="1"/>
        <rect class="scarf5 even" stroke-width="0" x="5.2" y="-2.5" width="2" height="1"/>
      </g>
      <g class="hat">
        <path class="top outline" d="M13.2,0.4V-0.2c-0.1-0.6-0.3-1.1-0.8-1.6C12-2.2,11.6-2.4,11.1-2.5l-0.2,0h-0.3v5.2h0.5V2.7c0.5-0.1,0.9-0.4,1.3-0.8l0.5-0.6C13.1,0.9,13.1,0.5,13.2,0z"/>
        <path class="bottom" d="M10.6-2.6v5.3"/>
        <path class="ball" d="M13.2,0L13.2,0v0.2l0.1,0.1l0.1,0.2c0.1,0.1,0.3,0.2,0.5,0.3c0.2,0,0.4-0.1,0.5-0.2c0.1-0.1,0.2-0.3,0.2-0.5c0-0.2-0.1-0.4-0.2-0.6s-0.3-0.2-0.5-0.2s-0.4,0.1-0.5,0.2l-0.2,0.3V0z"/>
      </g>
    </g>
    <g id="arm" class="arm outline">
      <path class="sleeve" d="M5-0.7H0l-0.4,0.1l-0.2,0.2L-0.7,0l0.1,0.4l0.1,0.2l0.3,0.2H0h5"/>
      <path class="hand" d="M5,0.8h1.6c0.2-0.1,0.3-0.1,0.4-0.2L7.1,0.4L7.1,0c0-0.2-0.1-0.4-0.2-0.5C6.8-0.7,6.6-0.7,6.4-0.7L6-0.7c0.2-0.4,0.1-0.6-0.1-0.6C5.7-1.2,5.6-1,5.5-0.7H5"/>
    </g>
    <path id="flag" class="flag" transform="translate(-6 -21)" d="M6,3A1,1 0 0,1 7,4V4.88C8.06,4.44 9.5,4 11,4C14,4 14,6 16,6C19,6 20,4 20,4V12C20,12 19,14 16,14C13,14 13,12 11,12C8,12 7,14 7,14V21H5V4A1,1 0 0,1 6,3Z" />
    <path id="start-flag" class="flag" transform="translate(-6 -21)" d="M6,3A1,1 0 0,1 7,4V4.88C8.06,4.44 9.5,4 11,4C14,4 14,6 16,6C19,6 20,4 20,4V12C20,12 19,14 16,14C13,14 13,12 11,12C8,12 7,14 7,14V21H5V4A1,1 0 0,1 6,3M7,7.25V11.5C7,11.5 9,10 11,10C13,10 14,12 16,12C18,12 18,11 18,11V7.5C18,7.5 17,8 16,8C14,8 13,6 11,6C9,6 7,7.25 7,7.25Z" />
  </defs>

  <!-- <rect x="0" y="0" width="70" height="70" fill="cyan"/> -->

  <g class="lr-sprite" lr:anchor="START_FLAG">
    <use x="52" y="19" xlink:href="#start-flag" />
    <circle class="lr-anchor" cx="52" cy="19" r="0.5" />
    <rect class="lr-bbox" x="50" y="0" width="17" height="20" />
  </g>
  <g class="lr-sprite" lr:anchor="FLAG">
    <use x="52" y="39" xlink:href="#flag" />
    <circle class="lr-anchor" cx="52" cy="39" r="0.5" />
    <rect class="lr-bbox" x="50" y="20" width="17" height="20" />
  </g>

  <g class="lr-sprite lr-stretch" lr:anchor="SHOULDER" lr:lookAt="SCARF_0" id="base-scarf">
    <rect class="scarf0" x="21" y="65" width="2" height="2"/>
    <circle class="lr-anchor" cx="21" cy="66" r="0.5" />
    <rect class="lr-bbox" x="20" y="64" width="4" height="4" />
  </g>
  <g class="lr-sprite" lr:copy="base-scarf" lr:anchor="SCARF_0" lr:lookAt="SCARF_1"></g>
  <g class="lr-sprite lr-stretch" lr:anchor="SCARF_1" lr:lookAt="SCARF_2">
    <rect class="scarf5" x="25" y="65" width="2" height="2"/>
    <circle class="lr-anchor" cx="25" cy="66" r="0.5" />
    <rect class="lr-bbox" x="24" y="64" width="4" height="4" />
  </g>
  <g class="lr-sprite" lr:copy="base-scarf" lr:anchor="SCARF_2" lr:lookAt="SCARF_3"></g>
  <g class="lr-sprite lr-stretch" lr:anchor="SCARF_3" lr:lookAt="SCARF_4">
    <rect class="scarf3" x="29" y="65" width="2" height="2"/>
    <circle class="lr-anchor" cx="29" cy="66" r="0.5" />
    <rect class="lr-bbox" x="28" y="64" width="4" height="4" />
  </g>
  <g class="lr-sprite" lr:copy="base-scarf" lr:anchor="SCARF_4" lr:lookAt="SCARF_5"></g>
  <g class="lr-sprite lr-stretch" lr:anchor="SCARF_5" lr:lookAt="SCARF_6">
    <rect class="scarf1" x="33" y="65" width="2" height="2"/>
    <circle class="lr-anchor" cx="33" cy="66" r="0.5" />
    <rect class="lr-bbox" x="32" y="64" width="4" height="4" />
  </g>

  <g class="lr-sprite" lr:params="broken" lr:anchor="PEG" lr:lookAt="STRING">
    <g lr:param-broken="0">
      <use x="51.5" y="43.3" xlink:href="#sled" />
      <circle class="lr-anchor" cx="51.5" cy="43.3" r="0.5" />
      <rect class="lr-bbox" x="50" y="40" width="19.8" height="9.4" />
    </g>
    <g lr:param-broken="1">
      <use x="51.4" y="53" xlink:href="#broken-sled" />
      <circle class="lr-anchor" cx="51.4" cy="53" r="0.5" />
      <rect class="lr-bbox" x="50" y="49.7" width="19.3" height="8.5" />
    </g>
  </g>

  <g class="lr-sprite" lr:anchor="BUTT" lr:lookAt="LFOOT" id="base-leg">
    <use x="11.7" y="67" xlink:href="#leg" />
    <circle class="lr-anchor" cx="11.7" cy="67" r="0.5" />
    <rect class="lr-bbox" x="10" y="64" width="9.9" height="4.7" />
  </g>

  <g class="lr-sprite lr-stretch" lr:params="crashed" lr:anchor="LHAND" lr:lookAt="STRING" id="base-string">
    <g lr:param-crashed="0">
      <line id="debug" x1="37" y1="65.5" x2="45" y2="65.5" stroke-width="0.3" stroke="black"/>
      <circle class="lr-anchor" cx="37" cy="65.5" r="0.5" />
      <rect class="lr-bbox" x="36" y="64" width="10" height="3" />
    </g>
    <g class="lr-null" lr:param-crashed="1"></g>
  </g>

  <g class="lr-sprite" lr:anchor="SHOULDER" lr:lookAt="LHAND" id="base-arm">
    <use x="1.7" y="66.3" xlink:href="#arm" />
    <circle class="lr-anchor" cx="1.7" cy="66.3" r="0.5" />
    <rect class="lr-bbox" x="0" y="64" width="9.8" height="4.1" />
  </g>

  <g class="lr-sprite" lr:copy="base-leg" lr:anchor="BUTT" lr:lookAt="RFOOT"></g>

  <g class="lr-sprite" lr:params="rotation blinking" lr:anchor="BUTT" lr:lookAt="SHOULDER" id="face-group">
  </g>

  <g class="lr-sprite" lr:anchor="BUTT" lr:lookAt="SHOULDER">
    <use x="51" y="63" xlink:href="#body" />
    <circle class="lr-anchor" cx="51" cy="63" r="0.5" />
    <rect class="lr-bbox" x="50" y="59" width="16.6" height="8.1" />
  </g>

  <g class="lr-sprite" lr:copy="base-string" lr:anchor="RHAND" lr:lookAt="STRING"></g>

  <g class="lr-sprite" lr:copy="base-arm" lr:anchor="SHOULDER" lr:lookAt="RHAND"></g>

  <script><![CDATA[
    const P = 2
    function makeHeads ({blinking, rows, xOffset, yOffset, dx, dy}) {
      return Array(40).fill().map((_, i) => [i, 2 - i / 10]).map(([i, t]) => {
        let x = xOffset + dx * (i % rows)
        let y = yOffset + dy * ((i / rows) | 0)
        let id = `${i}-${blinking ? 1 : 0}`
        let u = Math.max(t > 1 ? 2 - t : t, 0)
        let v = -Math.min(t < -1 ? -2 - t : t, 0)
        let facePath = [
          'M', 10.1, -2.4,
          'c', -1.9 * v - 3.1 * (1 - v), -1.2 * v, -3.0 * v - 3.1 * (1 - v), -1.3 * v, -3.1, 0,
          'v', 4.9,
          'c', 0.1 * u, 1.3 * u, 1.2 * u, 1.2 * u, 3.1, 0,
          'z'
        ].map(x => typeof x === 'number' ? x.toFixed(P) : x).join(' ')
        let yPos = (-2.6 * (1 - t)).toFixed(P)
        // return [facePath, yPos]
        return `
    <g lr:param-rotation="${i}" lr:param-blinking="${blinking | 0}">
      <g transform="translate(${x}, ${y})">
        <g clip-path="url(#clipHead${id})">
          <use xlink:href="#face${blinking ? '-blinking' : ''}" x="0" y="${yPos}"/>
        </g>
        <clipPath id="clipHead${id}">
          <use xlink:href="#head${id}"/>
        </clipPath>
        <path id="head${id}" class="outline no-fill" d="${facePath}"/>
      </g>
      <circle class="lr-anchor" cx="${x}" cy="${y}" r="0.5" />
      <rect class="lr-bbox" x="${x - 1 + 7}" y="${y - 1 - 3}" width="5" height="8" />
    </g>`
      })
    }
    let opts = {
      blinking: false,
      rows: 10,
      xOffset: -6,
      yOffset: 4,
      dx: 5,
      dy: 8
    }
    let nodes = [...makeHeads(opts), ...makeHeads({...opts, blinking: true, yOffset: 36})]
    document.getElementById('face-group').innerHTML = nodes.join('\n')

    // console.log(document.getElementById('debug').getBBox())

    let svg = document.querySelector('svg')
    svg.removeChild(document.querySelector('script'))

    let text = (new XMLSerializer()).serializeToString(document)

    let button = document.createElementNS('http://www.w3.org/2000/svg', 'g')
    button.innerHTML = `<text x="0" y="35" transform="scale(0.5)">click2download</text>`
    button.onclick = () => {
      let win = window.open()
      if (!win) {
        alert('enable pop ups pls')
      } else {
        win.document.body.innerHTML = `
        <a download="bosh-sprite.svg" href="${'data:image/svg+xml,' + encodeURIComponent(text)}">
          <text>download</text>
        </a>`
      }

    }
    svg.appendChild(button)

  ]]></script>

</svg>
